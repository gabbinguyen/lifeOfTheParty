!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.urlComposer=r()}(this,function(){"use strict";function n(n){return"[object Array]"===Object.prototype.toString.call(n)}function r(n){if(null==n)return!0;if(n.length>0)return!1;if(0===n.length)return!0;if("object"!=typeof n)return!0;for(var r in n)if(hasOwnProperty.call(n,r))return!1;return!0}function e(n,e){return n=n||"",e=e||[],r(e)?o(n):(n=t(n,e),i(f(n)))}function t(r,e){if(e=e||[],!n(e)){var t=r.match(R);t&&(e=t.map(function(n){return e[n.substr(1)]}))}n(e)&&e.forEach(function(n){n&&(r=a(r,n))});var o=r.match(E);return o&&o.forEach(function(n){u(n)&&(r=r.replace(n,""))}),r}function a(n,r){var e=-1!==n.indexOf(":");return r=encodeURIComponent(r),e?n.replace(P,r):n.replace(O,r)}function u(n){return P.test(n)||O.test(n)}function o(n){return n.replace(E,"")}function i(n){return n.replace(w,"")}function c(n){return n.replace(x,"")}function f(n){return n.replace(j,"")}function s(n){var r=n.host,e=n.path,t=n.query,a=n.hash;r=i(r);var u=e.split("?"),o=u[0],f=u[1];return e=i(c(o)),e=e?"/"+e:"",f=f?f+"&":"",t=t?"?"+f+t:"",a=a?"#"+a:"",""+r+e+t+a}function p(n,r){for(var e=[],t=0;t<n.length;t++){var a=n[t];a[r]&&""===a.value&&e.push(a)}return e}function l(n){return{named:n&&n.match(R)||[],splat:n&&n.match(O)||[]}}function h(n){return n=n.replace($,"\\$&").replace(E,"(?:$1)?").replace(R,function(n,r){return r?n:"([^/?]+)"}).replace(O,"([^?]*?)"),new RegExp("^"+n+"(?:\\?([\\s\\S]*))?$")}function m(n){return n=n||{},e(n.path,n.params)}function d(n){var r=[];n=n||{};for(var e in n.query){var t=n.query[e];r.push(e+"="+encodeURIComponent(t))}return r.length?r.join("&"):""}function v(n){return n=n||{},h(n.path).test(n.url)}function g(n){n=n||{},n.host=n.host||"";var r=m(n),e=d(n);return s({host:n.host,path:r,query:e,hash:n.hash})}function y(n,r){function e(n){t[n.slice(1)]=r[u++]}var t={},a=l(n),u=0;return a.named.forEach(e),a.splat.forEach(e),t}function q(r,e){var t=r.match(E)||[],a=l(r),u=a.named,o=a.splat,i=u.concat(o);return e=e||{},n(e)&&(e=y(r,e)),i=i.map(function(n){for(var r=!1,a=0;a<t.length;a++){if(-1!==t[a].indexOf(n)){r=!0;break}}return{name:n,value:e[n.slice(1)]||"",optional:r,required:!r}}),{params:i,hasOptionalParams:E.test(r),missingOptionalParams:p(i,"optional"),missingRequiredParams:p(i,"required"),missingParams:p(i,"name")}}function b(n){void 0===n&&(n={});var r=n.path,e=n.definition,t=n.object;if(!r&&!e)throw new Error("url-composer: Missing path and definition");var a=h(e),u=a.exec(r);if(!u)return null;u=u.slice(1);var o=u.map(function(n,r){return r===u.length-1?n||null:n?decodeURIComponent(n):null});if(t){var i=o.pop();o=y(e,o),o.query=i}return o}var w=/\/$/,x=/^\//,j=/[()]/g,E=/\((.*?)\)/g,O=/\*\w+/g,P=/(\(\?)?:\w+/,R=/(\(\?)?:\w+/g,$=/[-{}[\]+?.,\\^$|#\s]/g;return{build:g,test:v,stats:q,parse:b,params:y,path:m,query:d,regex:h,match:l}});
